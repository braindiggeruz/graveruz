<!doctype html>
<html lang="ru">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <meta name="theme-color" content="#14b8a6" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <link rel="manifest" href="/manifest.json" />
        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link rel="preconnect" href="https://connect.facebook.net" />
        <title>Graver.uz</title>

        <!-- Block Stape before GTM loads -->
        <script>
        // Initialize dataLayer BEFORE GTM loads
        window.dataLayer = window.dataLayer || [];
        
        // Store original gtag function
        var originalGtag = window.gtag;
        
        // Create wrapper gtag that blocks Stape
        window.gtag = function() {
          var args = Array.prototype.slice.call(arguments);
          
          // Get event name (first argument)
          var eventName = args[0];
          var eventData = args[1];
          
          // Block Stape-related configs and events
          if (eventName === 'config') {
            // Check if this is a Stape config
            if (typeof eventData === 'string' && eventData.includes('stape')) {
              console.log('[Stape Blocker] Blocked Stape config:', eventData);
              return;
            }
          }
          
          if (eventName === 'event') {
            // Check if event name contains stape
            if (typeof eventData === 'string' && eventData.toLowerCase().includes('stape')) {
              console.log('[Stape Blocker] Blocked Stape event:', eventData);
              return;
            }
            // Check if event data contains stape references
            if (typeof eventData === 'object' && eventData !== null) {
              for (var key in eventData) {
                if (eventData[key] && eventData[key].toString().toLowerCase().includes('stape')) {
                  console.log('[Stape Blocker] Blocked Stape event with stape data');
                  return;
                }
              }
            }
          }
          
          // Pass through non-Stape events
          if (originalGtag) {
            return originalGtag.apply(window, arguments);
          }
        };
        
        // Mark gtag as ready
        window.gtag.l = new Date().getTime();
        </script>

        <!-- Meta Pixel Code -->
        <script>
        !function(f,b,e,v,n,t,s)
        {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
        n.callMethod.apply(n,arguments):n.queue.push(arguments)};
        if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
        n.queue=[];t=b.createElement(e);t.async=!0;
        t.src=v;s=b.getElementsByTagName(e)[0];
        s.parentNode.insertBefore(t,s)}(window, document,'script',
        'https://connect.facebook.net/en_US/fbevents.js');
        fbq('init', '1358428289305229');
        fbq('track', 'PageView');
        </script>
        <noscript><img height="1" width="1" style="display:none"
        src="https://www.facebook.com/tr?id=1358428289305229&ev=PageView&noscript=1"
        /></noscript>
        <!-- End Meta Pixel Code -->

    </head>
    <body>
        <noscript>You need to enable JavaScript to run this app.</noscript>
        <div id="root"></div>

        <!-- Service Worker Disabled in Production -->
        <script>
        (function() {
          if (!('serviceWorker' in navigator)) return;

          var host = window.location.hostname;
          var isProdHost = [
            'graver-studio.uz',
            'graver.uz',
            'www.graver.uz'
          ].indexOf(host) !== -1;
          var forceKill = window.location.search.indexOf('sw-kill=1') !== -1;

          if (!isProdHost && !forceKill) return;

          navigator.serviceWorker.getRegistrations()
            .then(function(regs) {
              regs.forEach(function(reg) {
                reg.unregister();
              });
            })
            .catch(function() {});

          if ('caches' in window) {
            caches.keys()
              .then(function(keys) {
                keys.forEach(function(key) {
                  caches.delete(key);
                });
              })
              .catch(function() {});
          }
        })();
        </script>
    </body>
</html>
