<!doctype html>
<html lang="ru">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <meta name="theme-color" content="#14b8a6" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <link rel="manifest" href="/manifest.json" />
        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link rel="preconnect" href="https://connect.facebook.net" />
        <title>Graver.uz</title>

        <!-- Disable Stape in GTM before GTM loads -->
        <script>
        window.dataLayer = window.dataLayer || [];
        
        // Disable Stape tags by preventing them from firing
        window.gtag = window.gtag || function() {
          window.dataLayer.push(arguments);
        };
        
        // Intercept GTM events to block Stape
        var originalPush = window.dataLayer.push;
        window.dataLayer.push = function() {
          var args = Array.prototype.slice.call(arguments);
          
          // Block Stape-related events
          for (var i = 0; i < args.length; i++) {
            var arg = args[i];
            if (typeof arg === 'object' && arg !== null) {
              // Check if this is a Stape event
              if (arg.event && (arg.event.includes('stape') || arg.event.includes('Stape'))) {
                console.log('[GTM Blocker] Blocked Stape event:', arg.event);
                return;
              }
              // Check if config contains Stape
              if (arg.config && typeof arg.config === 'string' && arg.config.includes('stape')) {
                console.log('[GTM Blocker] Blocked Stape config');
                return;
              }
            }
          }
          
          return originalPush.apply(window.dataLayer, arguments);
        };
        </script>

        <!-- Meta Pixel Code -->
        <script>
        !function(f,b,e,v,n,t,s)
        {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
        n.callMethod.apply(n,arguments):n.queue.push(arguments)};
        if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
        n.queue=[];t=b.createElement(e);t.async=!0;
        t.src=v;s=b.getElementsByTagName(e)[0];
        s.parentNode.insertBefore(t,s)}(window, document,'script',
        'https://connect.facebook.net/en_US/fbevents.js');
        fbq('init', '1358428289305229');
        fbq('track', 'PageView');
        </script>
        <noscript><img height="1" width="1" style="display:none"
        src="https://www.facebook.com/tr?id=1358428289305229&ev=PageView&noscript=1"
        /></noscript>
        <!-- End Meta Pixel Code -->

    </head>
    <body>
        <noscript>You need to enable JavaScript to run this app.</noscript>
        <div id="root"></div>

        <!-- Service Worker Disabled in Production -->
        <script>
        (function() {
          if (!('serviceWorker' in navigator)) return;

          var host = window.location.hostname;
          var isProdHost = [
            'graver-studio.uz',
            'graver.uz',
            'www.graver.uz'
          ].indexOf(host) !== -1;
          var forceKill = window.location.search.indexOf('sw-kill=1') !== -1;

          if (!isProdHost && !forceKill) return;

          navigator.serviceWorker.getRegistrations()
            .then(function(regs) {
              regs.forEach(function(reg) {
                reg.unregister();
              });
            })
            .catch(function() {});

          if ('caches' in window) {
            caches.keys()
              .then(function(keys) {
                keys.forEach(function(key) {
                  caches.delete(key);
                });
              })
              .catch(function() {});
          }
        })();
        </script>
    </body>
</html>
